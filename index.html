<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phone Location Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; }
    .container { max-width: 500px; margin: auto; }
    textarea, input { width: 100%; margin-bottom: 10px; }
    iframe { border: none; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Phone Location Tracker</h2>

    <button onclick="startSharing()">Start Sharing My Location</button>
    <button onclick="stopSharing()">Stop Sharing</button>
    <button onclick="startViewing()">View Tracked Phone</button>

    <p id="status"></p>

    <textarea id="Address" rows="4" readonly>Waiting for location...</textarea>

    <div>
      <input type="text" id="latitude" placeholder="Latitude" readonly>
      <input type="text" id="longitude" placeholder="Longitude" readonly>
    </div>

    <iframe id="iframe"
      src="https://www.google.com/maps?q=&z=5&output=embed"
      width="100%"
      height="300">
    </iframe>
  </div>

  <script>
    const SERVER_URL = "http:// 192.168.137.52:5000"; // replace with your PC IP
    let watchId = null;
    let viewingInterval = null;

    async function sendLocation(lat, lon) {
      try {
        await fetch(`${SERVER_URL}/update`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ lat, lon })
        });
        document.getElementById("status").innerText = " Location sent!";
      } catch (error) {
        document.getElementById("status").innerText = " Failed to send location";
        console.error(error);
      }
    }

    async function fetchTrackedLocation() {
      try {
        const res = await fetch(`${SERVER_URL}/get`);
        const data = await res.json();

        if (data.lat && data.lon) {
          updateUI(data.lat, data.lon);
        } else {
          document.getElementById("status").innerText = "‚è≥ Waiting for phone to send location...";
        }
      } catch (error) {
        document.getElementById("status").innerText = " Error fetching location";
        console.error(error);
      }
    }

    function updateUI(lat, lon) {
      document.getElementById("latitude").value = lat;
      document.getElementById("longitude").value = lon;
      document.getElementById("iframe").src = `https://www.google.com/maps?q=${lat},${lon}&z=15&output=embed`;
      document.getElementById("Address").value = `Latitude: ${lat}\nLongitude: ${lon}`;
    }

    function startSharing() {
      if (navigator.geolocation) {
        document.getElementById("status").innerText = " Getting your location...";
        watchId = navigator.geolocation.watchPosition(
          (pos) => {
            const lat = pos.coords.latitude.toFixed(6);
            const lon = pos.coords.longitude.toFixed(6);
            updateUI(lat, lon);
            sendLocation(lat, lon);
          },
          (err) => {
            document.getElementById("status").innerText = "Cannot get location: " + err.message;
          },
          { enableHighAccuracy: true }
        );
      } else {
        alert("Geolocation is not supported on this device.");
      }
    }

    function stopSharing() {
      if (watchId !== null) {
        navigator.geolocation.clearWatch(watchId);
        watchId = null;
        document.getElementById("status").innerText = "‚èπ Stopped sharing location.";
      }
    }

    function startViewing() {
      if (viewingInterval === null) {
        viewingInterval = setInterval(fetchTrackedLocation, 3000); // refresh every 3s
        document.getElementById("status").innerText = "üëÄ Viewing tracked phone location...";
      }
    }
  </script>
</body>
</html>

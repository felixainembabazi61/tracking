
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real-Time Location Tracker</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <div class="container">
    <h2>Real-Time Location Tracker</h2>
    <input type="text" id="userId" placeholder="Enter your name or ID" style="padding:5px;">

    <br><br>
    <button id="button" onclick="startTracking()">Start Sharing My Location</button>
    <button id="stopButton" onclick="stopTracking()" style="display:none;">Stop Sharing</button>

    <div class="location-details">
      <h3>My Location</h3>
      <textarea id="Address" rows="4" readonly>Waiting for location...</textarea>

      <label>Coordinates</label>
      <div class="coords">
        <input type="text" id="latitude" value="00.000000" readonly>
        <input type="text" id="longitude" value="00.000000" readonly>
      </div>

      <p id="status"></p>
    </div>

    <div class="map-section">
      <iframe id="iframe"
        src="https://www.google.com/maps?q=&z=5&output=embed"
        allowfullscreen
        loading="lazy"
        width="100%"
        height="300">
      </iframe>
    </div>

    <h3>Other Users</h3>
    <select id="userSelect" onchange="focusUser(this.value)">
      <option value="">-- Select a user to view --</option>
    </select>
  </div>


  <script>
    let watchId = null;
    let currentUser = null;

    
    const firebaseConfig = {
      apiKey: "AIzaSyBR0jlsdxb31InhvYvmKdwC-yNytIjfecE",
	authDomain: "location-tracking-3efeb.firebaseapp.com",
	databaseURL: "https://location-tracking-3efeb-default-rtdb.firebaseio.com",
	projectId: "location-tracking-3efeb",
	storageBucket: "location-tracking-3efeb.firebasestorage.app",
	messagingSenderId: "588561745176",
	appId: "1:588561745176:web:9d147c99d9007ab0750a6d",
	measurementId: "G-ZH41R60SP9"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    
    async function updateLocation(position) {
      const lat = position.coords.latitude.toFixed(6);
      const lon = position.coords.longitude.toFixed(6);

      document.getElementById("latitude").value = lat;
      document.getElementById("longitude").value = lon;
      document.getElementById("status").innerText =
        `Accuracy: $

{position.coords.accuracy.toFixed(1)} meters`;

      document.getElementById("iframe").src =
        `https://www.google.com/maps?q=${lat},${lon}&z=15&output=embed`;

      
      if (currentUser) {
        db.ref("users/" + currentUser).set({
          lat: lat,
          lon: lon,
          timestamp: Date.now()
        });
      }

      try {
        const response = await fetch(
          `https://nominatim.openstreetmap.org/reverse?

lat=${lat}&lon=${lon}&format=json`
        );
        const data = await response.json();

        if (data && data.address) {
          const addr = data.address;
          const addressText = `
            Continent: ${addr.continent || "N/A"}
            Country: ${addr.country || "N/A"}
            State/Region: ${addr.state || "N/A"}
            District: ${addr.county || addr.city_district || "N/A"}
            City/Town: ${addr.city || addr.town || addr.village || "N/A"}
            Street: ${addr.road || "N/A"}
            Postal Code: ${addr.postcode || "N/A"}
            Facility/Place: ${addr.public_building || addr.neighbourhood || addr.suburb || "N/A"}
          `.trim();

          document.getElementById("Address").value = addressText;
        } else {
          document.getElementById("Address").value = "Address not found!";
        }
      } catch (error) {
        document.getElementById("Address").value = "Failed to fetch address.";
      }
    }

    
    function startTracking() {
      const userIdInput = document.getElementById("userId").value.trim();

      if (!userIdInput) {
        alert("Please enter your name or ID before starting.");
        return;
      }
      currentUser = userIdInput;

      if (navigator.geolocation) {
        document.getElementById("status").innerText = "Getting location...";
        watchId = navigator.geolocation.watchPosition(
          updateLocation,
          (error) => {
            document.getElementById("status").innerText =
              "Unable to fetch location: " + error.message;
          },

          {
            enableHighAccuracy: true,
            maximumAge: 0,
            timeout: 10000,
          }
        );
        document.getElementById("button").style.display = "none";
        document.getElementById("stopButton").style.display = "inline-block";
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }

    function stopTracking() {
      if (watchId !== null) {
        

navigator.geolocation.clearWatch(watchId);
        watchId = null;
        document.getElementById("status").innerText = "Tracking stopped.";
        document.getElementById("button").style.display = "inline-block";
        document.getElementById("stopButton").style.display = "none";
      }
      if (currentUser) {
        db.ref("users/" + currentUser).remove();
      }
    }

    
    db.ref("users").on("value", (snapshot) => {

      const users = snapshot.val() || {};
      const select = document.getElementById("userSelect");
      select.innerHTML = '<option value="">-- Select a user to view --</option>';

      Object.keys(users).forEach((user) => {
        if (user !== currentUser) {
          const option = document.createElement("option");
          option.value = JSON.stringify(users[user]);
          option.text = user;
          select.add(option);
        }
      });
    });

    function focusUser(userData) {
      if (!userData) return;
      const { lat, lon } = JSON.parse(userData);

      document.getElementById("iframe").src =
        `https://www.google.com/maps?q=${lat},${lon}&z=15&output=embed`;
    }
  </script>
</body>
</html>

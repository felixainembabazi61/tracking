<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real-Time Location Tracker</title>
</head>
<body>
  <div class="container">
    <button id="button" onclick="startTracking()">Start Tracking</button>
    <button id="stopButton" onclick="stopTracking()" style="display:none;">Stop Tracking</button>

    <div class="location-details">
      <div class="form-section">
        <label>Address</label>
        <textarea id="Address" rows="4" readonly>Waiting for location...</textarea>

        <label>Coordinates</label>
        <div class="coords">
          <input type="text" id="latitude" value="00.000000" readonly>
          <input type="text" id="longitude" value="00.000000" readonly>
        </div>
        <p id="status"></p>
      </div>

      <div class="map-section">
        <iframe id="iframe"
          src="https://www.google.com/maps?q=&z=5&output=embed"
          allowfullscreen
          loading="lazy"
          width="100%"
          height="300">
        </iframe>
      </div>
    </div>
  </div>

  <script>
    let watchId = null;

    async function updateLocation(position) {
      const lat = position.coords.latitude.toFixed(6);
      const lon = position.coords.longitude.toFixed(6);

      document.getElementById("latitude").value = lat;
      document.getElementById("longitude").value = lon;
      document.getElementById("status").innerText = 
        `Accuracy: ${position.coords.accuracy.toFixed(1)} meters`;

      document.getElementById("iframe").src =
        `https://www.google.com/maps?q=${lat},${lon}&z=15&output=embed`;

      try {
        const response = await fetch(
          `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`
        );
        const data = await response.json();

        if (data && data.address) {
          const addr = data.address;
          const addressText = `
            Continent: ${addr.continent || "N/A"}
            Country: ${addr.country || "N/A"}
            State/Region: ${addr.state || "N/A"}
            District: ${addr.county || addr.city_district || "N/A"}
            City/Town: ${addr.city || addr.town || addr.village || "N/A"}
            Street: ${addr.road || "N/A"}
            Postal Code: ${addr.postcode || "N/A"}
            Facility/Place: ${addr.public_building || addr.neighbourhood || addr.suburb || "N/A"}
          `.trim();

          document.getElementById("Address").value = addressText;
        } else {
          document.getElementById("Address").value = "Address not found!";
        }
      } catch (error) {
        document.getElementById("Address").value = "Failed to fetch address.";
        console.error("Reverse geocoding error:", error);
      }
    }

    function startTracking() {
      if (navigator.geolocation) {
        document.getElementById("status").innerText = "Getting location...";
        watchId = navigator.geolocation.watchPosition(
          updateLocation,
          (error) => {
            console.error("Geolocation error:", error);
            document.getElementById("status").innerText =
              "Unable to fetch location: " + error.message;
          },
          {
            enableHighAccuracy: true,
            maximumAge: 0,
            timeout: 10000,
          }
        );
        document.getElementById("button").style.display = "none";
        document.getElementById("stopButton").style.display = "inline-block";
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    }

    function stopTracking() {
      if (watchId !== null) {
        navigator.geolocation.clearWatch(watchId);
        watchId = null;
        document.getElementById("status").innerText = "Tracking stopped.";
        document.getElementById("button").style.display = "inline-block";
        document.getElementById("stopButton").style.display = "none";
      }
    }
  </script>
</body>
</html>